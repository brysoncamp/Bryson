function _(e){return Array.from(new Set(e))}function T(e,n){const t=I();return t[e]=t[e]||n}function I(){const e="_vike";return globalThis[e]=globalThis[e]||{}}const u=new Proxy({},{get:(e,n)=>t=>n==="code"?`\`${t}\``:n==="string"?`'${t}'`:t}),W="0.4.225",a=T("utils/assertSingleInstance.ts",{instances:[],alreadyLogged:new Set}),B="Client runtime of both Server Routing and Client Routing loaded https://vike.dev/client-runtimes-conflict",x="Client runtime loaded twice https://vike.dev/client-runtime-duplicated";function C(){{const e=_(a.instances);g(e.length<=1,`vike@${u.bold(e[0])} and vike@${u.bold(e[1])} loaded which is highly discouraged, see ${u.underline("https://vike.dev/warning/version-mismatch")}`,{onlyOnce:!0,showStackTrace:!1})}a.checkSingleInstance&&a.instances.length>1&&g(!1,x,{onlyOnce:!0,showStackTrace:!0})}function Y(e){g(a.isClientRouting!==!1,B,{onlyOnce:!0,showStackTrace:!0}),g(a.isClientRouting===void 0,x,{onlyOnce:!0,showStackTrace:!0}),a.isClientRouting=!0,a.checkSingleInstance=!0,C()}function N(){a.instances.push(W),C()}function g(e,n,{onlyOnce:t,showStackTrace:o}){if(e)return;const r=`[Vike][Warning] ${n}`;{const{alreadyLogged:i}=a,l=r;if(i.has(l))return;i.add(l)}console.warn(o?new Error(r):r)}function V(){return!(typeof process>"u"||!process.cwd||!process.versions||typeof process.versions.node>"u"||!process.release||process.release.name!=="node")}function h(e,n){const t=new Error(e);return V()&&(t.stack=A(t.stack,n)),t}function A(e,n){if(!e)return e;const t=G(e);let o=0;return t.filter(i=>i.includes(" (internal/")||i.includes(" (node:internal")?!1:o<n&&H(i)?(o++,!1):!0).join(`
`)}function H(e){return e.startsWith("    at ")}function G(e){return e.split(/\r?\n/)}function J(e){return typeof e=="object"&&e!==null}const s=T("utils/assert.ts",{alreadyLogged:new Set,logger(e,n){n==="info"?console.log(e):console.warn(e)},showStackTraceList:new WeakSet});N();const z="[vike]",D=`[vike@${W}]`,F="Bug",k=2;function Q(e,n){if(e)return;const t=(()=>{if(!n)return null;const l=typeof n=="string"?n:JSON.stringify(n);return u.dim(`Debug info (for Vike maintainers; you can ignore this): ${l}`)})();let r=[`You stumbled upon a Vike bug. Go to ${u.blue("https://github.com/vikejs/vike/issues/new?template=bug.yml")} and copy-paste this error. A maintainer will fix the bug (usually within 24 hours).`,t].filter(Boolean).join(" ");r=f(r),r=p(r,F),r=d(r,!0);const i=h(r,k);throw s.onBeforeLog?.(),i}function X(e,n,{showStackTrace:t}={}){if(e)return;t=t||s.alwaysShowStackTrace,n=f(n),n=p(n,"Wrong Usage"),n=d(n);const o=h(n,k);throw t&&s.showStackTraceList.add(o),s.onBeforeLog?.(),o}function U(e){return e=f(e),e=p(e,"Error"),e=d(e),h(e,k)}function q(e,n,{onlyOnce:t,showStackTrace:o}){if(!e){if(o=o||s.alwaysShowStackTrace,n=f(n),n=p(n,"Warning"),n=d(n),t){const{alreadyLogged:r}=s,i=t===!0?n:t;if(r.has(i))return;r.add(i)}if(s.onBeforeLog?.(),o){const r=h(n,k);s.showStackTraceList.add(r),s.logger(r,"warn")}else s.logger(n,"warn")}}function Z(e,n,{onlyOnce:t}){n=f(n),n=d(n);{const{alreadyLogged:o}=s,r=n;if(o.has(r))return;o.add(r)}s.onBeforeLog?.(),s.logger(n,"info")}function p(e,n){let t=`[${n}]`;const o=n==="Warning"?"yellow":"red";return t=u.bold(u[o](t)),`${t}${e}`}function f(e){return e.startsWith("[")?e:` ${e}`}function d(e,n=!1){return`${n?D:z}${e}`}function j(e){const n=e/1e3;if(n<120){const t=O(n);return`${t} second${L(t)}`}{const t=n/60,o=O(t);return`${o} minute${L(o)}`}}function O(e){let n=e.toFixed(1);return n.endsWith(".0")&&(n=n.slice(0,-2)),n}function L(e){return e==="1"?"":"s"}const w=T("utils/executeHook.ts",{userHookErrors:new WeakMap,pageContext:null});function M(e,n,t){const{hookName:o,hookFilePath:r,hookTimeout:{error:i,warning:l}}=n;let $,b;const P=new Promise((c,R)=>{$=y=>{m(),c(y)},b=y=>{m(),R(y)}}),m=()=>{v&&clearTimeout(v),S&&clearTimeout(S)},v=E(l)&&setTimeout(()=>{q(!1,`The ${o}() hook defined by ${r} is slow: it's taking more than ${j(l)} (https://vike.dev/hooksTimeout)`,{onlyOnce:!1})},l),S=E(i)&&setTimeout(()=>{const c=U(`The ${o}() hook defined by ${r} timed out: it didn't finish after ${j(i)} (https://vike.dev/hooksTimeout)`);b(c)},i);return(async()=>{try{K(t);const c=await e();$(c)}catch(c){J(c)&&w.userHookErrors.set(c,{hookName:o,hookFilePath:r}),b(c)}})(),P}function E(e){return!!e&&e!==1/0}function K(e){w.pageContext=e,Promise.resolve().then(()=>{w.pageContext=null})}export{X as a,u as b,q as c,Q as d,M as e,U as f,T as g,Z as h,J as i,Y as j,K as p,_ as u};
